<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui" name="viewport">
        <meta content="yes" name="apple-mobile-web-app-capable">
        <meta content="black" name="apple-mobile-web-app-status-bar-style">
        <link href="images/apple-touch-icon.png" rel="apple-touch-icon"/>
        <link href="images/apple-touch-startup-image-640x1096.png" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image">
        <!--Css Ends here-->
        <link href="css/themes/default/jquery.mobile-1.4.5.css" rel="stylesheet">
        <link href="style.css" rel="stylesheet" type="text/css"/>
        <link href="css/colors/color.css" rel="stylesheet" type="text/css"/>
        <link type="text/css" rel="stylesheet" href="css/font-awesome-4.7.0/css/font-awesome.min.css" />

        <style type="text/css">
            #keyboard {
            width:133.34%;
            margin:0 auto;
            }
            ol.keys {
            list-style-type:none;
            }
            ol.keys li {
            width:25%;
            display:block;
            text-align:center;
            height:2em;
            float:left;
            font-size:1.3em;
            font-family:sans-serif;
            padding-top:.7em;
            border:.5px solid rgb(100,100,100);
            color:white;
            background-color:#232b47;
            }

            ol.keys li:hover {
            cursor:pointer;
            }
            ol.keys li:active {
            background-color:#232b47;
            color:#000;
            }

            .ui-page-theme-b .ui-btn {
            background-color: #fff !important;
            border-color: transparent !important;
            color: #000 !important;
            text-shadow: none;
            font-size: 20px;
            padding: 5px;
            border-radius: 0px;
            }

            .ui-content{
            display: none;
            }

            @-webkit-keyframes spin {
                0% {
                    -webkit-transform: rotate(0deg);
                }
                100% {
                    -webkit-transform: rotate(360deg);
                }
            }
            @keyframes spin {
                0% {
                    transform: rotate(0deg);
                }
                100% {
                    transform: rotate(360deg);
                }
            }
        </style>
        <!--Css Starts here-->

        <!--Javascript Library Starts here-->
        <script type="text/javascript" src="js/jquery.min.js"></script>
        <script type="text/javascript" src="js/jquery.mobile-1.4.5.min.js"></script>
        <script type="text/javascript" src="js/jquery.validate.min.js"></script>
        <script type="text/javascript" src="js/pullToRefresh.js"></script>
        <script type="text/javascript" charset="utf-8" src="cordova.js"></script>
        <script type="text/javascript" src="js/common/translate.js"></script>
        <script type="text/javascript" src="js/common/language.js"></script>
        <script type="text/javascript" src="js/common/app.js"></script>
        <script defer type="text/javascript" src="js/common/check-token.js"></script>
        <script defer type="text/javascript" src="js/common/navigate-to-back.js"></script>
        <script defer type="text/javascript" src="js/common/navigate-to-next.js"></script>
        <script defer type="text/javascript" src="js/common/money-currency-decimal-position.js"></script>
        <script defer type="text/javascript" src="js/common/restrict-to-decimal-pref.js"></script>
        <script defer type="text/javascript" src="js/common/show-error-message.js"></script>
        <script defer type="text/javascript" src="js/common/show-spinner.js"></script>
        <script defer type="text/javascript" src="js/modules/exchange-money.js"></script>
        <!--Javascript Library Ends here-->
    </head>

    <body>
        <!-- <div class="loader"></div> -->
        <div class="secondarypage pageDiv" data-role="page" data-theme="b" id="features">
            <header>
                <div data-position="fixed" data-role="header">
                    <div class="nav_left_button">
                        <a data-nav-title="" data-nav-to="" href="#" onclick="backNavigateTo(event)">
                            <img alt="" src="images/icons/left-arrow.png" title=""/>
                        </a>
                    </div>
                    <div class="nav_center_logo">
                        <div class="p-title">
                            <h2 style="font-size:16px" data-localize="exchangeText">
                            </h2>
                        </div>
                    </div>
                    <div class="nav_right_button">
                        <a href="#right-panel">
                            <img alt="" src="images/icons/icons8-align-justify-80.png" title=""/>
                        </a>
                    </div>
                    <div class="clear">
                    </div>
                </div>
                <!-- Internet Connection Message Div -->
                <div align="center" class="no_internet_div" id="NoInternetDiv" style="color: green;font-size: 12px;font-family: 'Comic Sans MS', cursive, sans-serif;">
                    <span>
                    </span>
                </div>
                <!-- Check User Suspended -->
                <div class="userSuspendedDiv" style="display: none;text-align: center;font-weight: bold;">
                    <div class="alert alert-danger">
                        <i class="fa fa-flag"></i> <strong style="font-size: 24px;"><span data-localize="suspendedText"></span></strong>
                      <hr>
                      <p class="showUserSuspendedError"></p>
                    </div>
                </div>
            </header>
            <!-- /header -->

            <div class="ui-content animate-right-to-center" id="exchangeMoneyBlock" role="main" style="display: block;">
                <div class="pages_maincontent">
                    <div class="page_content">
                        <section class="margin-50" style="margin-top: 40px;text-align: left;">
                            <!--  <div class="Divs">
                                    <p class="requestMoney" style="color: green;font-size: 14px;font-weight: bold;margin-bottom: 40px;"></p>
                                </div> -->
                            <div class="loginform">
                                <div class="errorDiv" style="display: none">
                                    <div class="alert alert-danger">
                                        <p class="showError" style="text-align: center;">
                                        </p>
                                    </div>
                                </div>
                                <form class="moneyForm" id="exchange-money" method="post">
                                    <label>
                                        <span data-localize="exchangeFromWalletText"></span>
                                        <span id="top-balance" style="display: none;">
                                            (
                                            <b>
                                                <span data-localize="exchangeAvailableText"></span>
                                                <span class="show-fromWallet-balance" style="color: green;">
                                                </span>
                                            </b>
                                            )
                                        </span>
                                    </label>
                                    <!-- fromWallet = sendCurrency-->
                                    <select class="fromWallet" id="fromWallet" name="fromWallet">
                                    </select>
                                    <span id="fromWalletValidate" style="color: red;font-weight: bold">
                                    </span>
                                    <br>
                                        <label>
                                            <span data-localize="exchangeToWalletText"></span>
                                            <span id="bottom-balance" style="display: none;">
                                                (
                                                <b>
                                                    <span data-localize="exchangeAvailableText"></span>
                                                    <span class="toWalletBalance" style="color: green;">
                                                    </span>
                                                </b>
                                                )
                                            </span>
                                        </label>
                                        <!-- toWallet = sendCurrency-->
                                        <select class="toWallet" id="toWallet" name="toWallet">
                                        </select>
                                        <span id="toWalletValidate" style="color: red;font-weight: bold">
                                        </span>
                                        <!-- amount = sendCurrency = sendDisplay-->
                                        <label class="text-left">
                                            <span data-localize="exchangeGiveText"></span>
                                        </label>
                                        <input class="form_input require" data-role="none" id="sendDisplay" name="amount" placeholder="0.00" readonly="" type="text" value=""/>
                                        <span id="amountExchangeValidate" style="color: red;font-weight: bold">
                                        </span>
                                        <!-- bottom margin-->
                                        <div class="Divs">
                                            <p style="margin-bottom: 10px;">
                                            </p>
                                        </div>
                                        <!-- Exchange Rate-->

                                        <div class="div_exchange_rate" style="display: none;text-align: center;">
                                            <span class="exchange_rate">
                                            </span>
                                        </div>
                                        <br>
                                            <!-- Get Amount-->
                                            <div class="div_get_amount" style="display: none;text-align: center;">
                                                <label>
                                                    <span data-localize="exchangeGetText"></span>
                                                </label>
                                                <p class="getAmount" style="font-weight: bold;font-size: 26px !important;text-align: center;">
                                                    <b>
                                                    </b>
                                                </p>
                                                <span class="getAmountError" style="color: red;font-weight: bold">
                                                </span>
                                            </div>
                                            <!-- bottom margin-->
                                            <div class="Divs">
                                                <p style="margin-top: 10px;">
                                                </p>
                                            </div>
                                            <!--keyboard - amount-->
                                            <div id="keyboard">
                                                <ol class="keys">
                                                    <li data-number="1">
                                                        1
                                                    </li>
                                                    <li data-number="2">
                                                        2
                                                    </li>
                                                    <li data-number="3">
                                                        3
                                                    </li>
                                                    <li data-number="4">
                                                        4
                                                    </li>
                                                    <li data-number="5">
                                                        5
                                                    </li>
                                                    <li data-number="6">
                                                        6
                                                    </li>
                                                    <li data-number="7">
                                                        7
                                                    </li>
                                                    <li data-number="8">
                                                        8
                                                    </li>
                                                    <li data-number="9">
                                                        9
                                                    </li>
                                                    <li data-number="0">
                                                        0
                                                    </li>
                                                    <li data-number=".">
                                                        .
                                                    </li>
                                                    <li id="delete">
                                                        X
                                                    </li>
                                                </ol>
                                            </div>

                                        <button class="form_submit exchange-submit customBorderRadius" data-redirect="exchange-money-review.html" data-role="none" id="submit" name="submit" type="submit" value="Next">
                                            <span data-localize="sendMoneyNextBtnText"></span>
                                        </button>

                                        </br>
                                    </br>
                                </form>
                            </div>
                        </section>
                    </div>
                </div>
            </div>
            <!-- /content -->

            <div class="ui-content animate-right-to-center" id="exchangeMoneyReview" role="main">
                <div class="pages_maincontent">
                    <div class="page_content">
                        <section class="margin-50" style="margin-top: 40px;">
                            <div class="showCurrency">
                                <p style="font-size:14px;padding:5px;text-align: center;">
                                    <span data-localize="exchangeExchangingText"></span> <span class="fWalletAmount" style="font-weight: bold;">, <span data-localize="exchangeExchangingWhichIsText"></span>
                                    </span> <span data-localize="exchangeEquivalentToText"></span> <span class="toWalletAmount" style="font-weight: bold;">
                                    </span>
                                    <br>
                                        <span data-localize="exchangeRateText"></span>
                                        <span class="fromCurrencyRate" style="font-weight: bold;">
                                        </span>
                                        <span class="fromCurrencyCode" style="font-weight: bold;">
                                        </span>
                                        =
                                        <span class="toCurrencyRate" style="font-weight: bold;">
                                        </span>
                                        <span class="toCurrencyCode" style="font-weight: bold;">
                                        </span>
                                    </br>
                                </p>
                            </div>
                            <div class="loginform">
                                <h2 style="margin-top: 7px;font-size:14px">
                                    <span data-localize="exchangeText"></span> <span data-localize="sendMoneyAmntText"></span>
                                    <span class="dcurrencyAmount" style="float: right;">
                                    </span>
                                </h2>
                                <h2 style="margin-top: 7px;font-size:14px">
                                    <span data-localize="sendMoneyfeeText"></span>
                                    <span class="totalFees" style="float: right;">
                                    </span>
                                </h2>
                                <h2 style="margin-top: 7px;font-size:14px;border-top: 2px solid #ddd">
                                    <span data-localize="sendMoneytotalAmntText"></span>
                                    <span class="totalAmount" style="float: right;">
                                    </span>
                                </h2>

                                <button action="exchange-money-complete" class="form_submit exchangeMoneyComplete customBorderRadius" data-redirect="exchange-money-success.html" data-role="none" name="submit" type="submit">
                                    <i class="spinner fa fa-spinner fa-spin" style="display: none;"></i> <span data-localize="sendMoneyConfirmBtnText" id="exchangeConfirmBtnText"></span>
                                </button>
                            </div>
                        </section>
                    </div>
                </div>
            </div>

            <aside>
                <div data-display="reveal" data-position="right" data-role="panel" id="right-panel">
                    <div class="user_login_info">
                        <div class="user_thumb_container">
                            <div class="user_thumb">
                                <img alt="" class="image_src" src="images/author.png" title=""/>
                            </div>
                        </div>
                        <div class="user_details">
                            <p class="username" style="color: #fff;">
                            </p>
                        </div>
                        <nav class="user-nav" id="menuItem">
                            <!--Load a dynamice html content for menu-->
                        </nav>
                    </div>
                    <div class="close_loginpopup_button">
                        <a data-rel="close" href="#">
                            <img alt="" src="images/icons/black/menu_close.png" title=""/>
                        </a>
                    </div>
                </div>
            </aside>
            <!-- /panel -->
        </div>

        <script type="text/javascript">

            $(window).on('load', function()
            {
                if(networkState()=='none')
                {
                    onOffline();
                    $(window).scrollTop(0);
                }
                else
                {
                    if (window.localStorage.getItem('user-status') == 'Suspended')
                    {
                        userIsSuspended();
                        $('.ui-content').hide();
                        $(window).scrollTop(0);
                    }
                    else
                    {
                        //Restrit Amount Decimal Places
                        $("#sendDisplay").val(function()
                        {
                            let num = $('.keys').data('number');
                            if (this.value != '') {
                                return restrictNumberToPrefdecimalPlaces((this.value + num));
                            }
                        });

                        let exchangeMoneyValidationErrorMessage = localStorage.getItem('exchangeMoneyValidationErrorMessage');
                        if (exchangeMoneyValidationErrorMessage != null) {
                            showErrorMessage(exchangeMoneyValidationErrorMessage);
                            window.localStorage.removeItem('exchangeMoneyValidationErrorMessage');
                        }

                        //Promise call below
                        showExchangeGetUserExistingWallatesDetails()
                        .then(res =>
                        {
                            getBalanceOfBothFromAndToWallets(res['fromWalletValue'],res['top_balance'],res['showWalletBalance'],res['showWallet'],res['token'],res['user_id'])
                            .then(res =>
                            {
                                getWalletsExceptSelectedFromWallet(res['fromWallet'], res['token'], res['user_id']);
                            })
                        })
                        .catch(error => {
                            console.log(error);
                        });
                    }
                }
            });

            // var exchangeMoney =
            // {
            //     initialize: function()
            //     {
            //         document.addEventListener('deviceready', this.onDeviceReady.bind(this), false);
            //     },
            //     onDeviceReady: function()
            //     {
            //         this.receivedEvent('deviceready');
            //     },
            //     receivedEvent: function()
            //     {}
            // };
            // exchangeMoney.initialize();

            //From Wallet
            $(document).on('change', '.fromWallet', function (e)
            {
                $('#toWallet-button span').html('Choose one'); //removing toWallet Code
                var fromWallet = $('.fromWallet option:selected').val();
                var top_balance = $('#top-balance');
                var showWalletBalance = $('.show-fromWallet-balance');
                var showWallet = $('.show-fromWalletCode');
                var token    = localStorage.getItem('token');
                var user_id  = localStorage.getItem('user_id');

                if(networkState()=='none')
                {
                    onOffline();
                    $(window).scrollTop(0);
                }
                else
                {
                    onOnline();
                    hideExchangeRateGetAmountDiv();
                    getWalletsExceptSelectedFromWallet(fromWallet, token, user_id);
                    getBalanceOfBothFromAndToWallets(fromWallet, top_balance, showWalletBalance, showWallet, token, user_id);
                }
            });

             //To Wallet
            $(document).on('change', '.toWallet', function (e)
            {
                var toCurrency = $(this).find(':selected').val();
                var bottom_balance = $('#bottom-balance');
                var toWalletBalance = $('.toWalletBalance');
                var toWallet = $('.to-wallet');
                var token    = localStorage.getItem('token');
                var user_id  = localStorage.getItem('user_id');

                if(networkState()=='none')
                {
                    onOffline();
                    $(window).scrollTop(0);
                }
                else
                {
                    onOnline();
                    hideExchangeRateGetAmountDiv();
                    getBalanceOfBothFromAndToWallets(toCurrency, bottom_balance, toWalletBalance, toWallet, token, user_id)
                    getAmountFromGive();
                }
            });

            //Type amount using num pad
            $('.keys').on('click', 'li', function() {
                var num = $(this).data('number')
                $("#sendDisplay").val(function() {
                    //Restrit Amount Decimal Places
                    return restrictNumberToPrefdecimalPlaces((this.value + num));
                });
                $('#sendDisplay').valid();

                if(networkState()=='none')
                {
                    onOffline();
                    $(window).scrollTop(0);
                }
                else
                {
                    onOnline();
                    getAmountFromGive();
                }
            });

            //Delete number when press cross button
            $('#delete').click(function()
            {
                var text      = $('#sendDisplay').val();
                var backSpace = text.substr(0, text.length-1);
                $('#sendDisplay').val(backSpace);
                $('#sendDisplay').valid();

                if(networkState()=='none')
                {
                    onOffline();
                    $(window).scrollTop(0);
                }
                else
                {
                    onOnline();
                    getAmountFromGive();
                    return false;
                }
            });

            //Amount
            $(document).on('input', '#sendDisplay', function ()
            {
                if(networkState()=='none')
                {
                    onOffline();
                    $(window).scrollTop(0);
                }
                else
                {
                    onOnline();
                    getAmountFromGive();
                }
            });


            //exchange-money - submit
            $('#exchange-money').validate({
                rules: {
                    fromWallet: {
                        required: true
                    },
                    toWallet:{
                        required: true
                    },
                    amount:{
                        required:true,
                        number:true,
                    }
                },
                errorPlacement: function (error, element)
                {
                    if (element.attr('name') === 'fromWallet')
                    {
                        error.appendTo('#fromWalletValidate');
                    }
                    else if (element.attr('name') === 'toWallet')
                    {
                        error.appendTo('#toWalletValidate');
                    }
                    else if (element.attr('name') === 'amount')
                    {
                        error.appendTo('#amountExchangeValidate');
                    }
                    else
                    {
                        error.insertAfter(element);
                    }
                },
                submitHandler: function (form,e)
                {
                    e.preventDefault();
                    if(networkState()=='none')
                    {
                        onOffline();
                        $(window).scrollTop(0);
                    }
                    else
                    {
                        onOnline();
                        exchangeSubmit();
                    }
                }
            });

            //exchangeMoneyComplete
            $(document).on('click', '.exchangeMoneyComplete', function(e)
            {
                e.preventDefault();

                //disable submit button
                let exchangeShowLoadingText = (window.localStorage.getItem('language') == 'fr') ? 'Confirmation...' : 'Confirming...';
                showSpinnerWithButtonDisabled(".exchangeMoneyComplete", "#exchangeConfirmBtnText", exchangeShowLoadingText);

                if(networkState()=='none')
                {
                    onOffline();
                    $(window).scrollTop(0);
                }
                else
                {
                    onOnline();
                    exchangeMoneyComplete();
                }
            });

        </script>
        <!-- /script ends -->
    </body>
</html>